# content of: tox.ini , put in same dir as setup.py
[tox]
envlist = py27,py27-nolxml,py32,py32-nolxml,pypy,py25-simplejson,sphinxext,tg11,tg15,pecan,coverage

[common]
testtools =
    nose
    webtest
    coverage

soapdeps =
    suds

deps=
    {[common]testtools}
    d2to1


[testenv]
deps = 
    {[common]deps}
    {[common]soapdeps}
    transaction
    lxml

setenv=
    COVERAGE_FILE=.coverage.{envname}

#commands=nosetests --verbose []
commands=
    {envbindir}/coverage run {envbindir}/nosetests --with-xunit --xunit-file nosetests-{envname}.xml wsme/tests wsmeext/tests --verbose {posargs}
    {envbindir}/coverage xml -o coverage-{envname}.xml wsme/*.py wsme/rest/*.py wsmeext/*.py
    {envbindir}/coverage report --show-missing wsme/*.py wsme/rest/*.py wsmeext/*.py

downloadcache=.tox/cache

[testenv:py25-simplejson]
basepython=python2.5
deps=
    {[common]deps}
    {[common]soapdeps}
    lxml
    simplejson
    zope.interface<=3.8.99
    transaction<=1.1.1

[testenv:py27-nolxml]
basepython=python2.7
deps=
    {[common]deps}
    {[common]soapdeps}
    transaction

[testenv:py32]
basepython=python3.2
deps=
    {[common]deps}
    transaction
    lxml
    https://bitbucket.org/bernh/suds-python-3-patches/downloads/suds_patched.zip

commands=
    {envbindir}/coverage run {envbindir}/nosetests --with-xunit --xunit-file nosetests-{envname}.xml wsme/tests wsmeext/tests --verbose {posargs}
    {envbindir}/coverage xml -o coverage-{envname}.xml --omit wsmeext/sphinxext.py wsme/*.py wsme/rest/*.py wsmeext/*.py
    {envbindir}/coverage report --show-missing --omit wsmeext/sphinxext.py wsme/*.py wsme/rest/*.py wsmeext/*.py

[testenv:py32-nolxml]
basepython=python3.2
deps=
    {[common]deps}
    transaction
    https://bitbucket.org/bernh/suds-python-3-patches/downloads/suds_patched.zip

commands=
    {envbindir}/coverage run {envbindir}/nosetests --with-xunit --xunit-file nosetests-{envname}.xml wsme/tests wsmeext/tests --verbose {posargs}
    {envbindir}/coverage xml -o coverage-{envname}.xml --omit wsmeext/sphinxext.py wsme/*.py wsme/rest/*.py wsmeext/*.py
    {envbindir}/coverage report --show-missing --omit wsmeext/sphinxext.py wsme/*.py wsme/rest/*.py wsmeext/*.py


[testenv:pypy-nolxml]
deps=
    {[common]deps}
    {[common]soapdeps}
    transaction
    https://bitbucket.org/bernh/suds-python-3-patches/downloads/suds_patched.zip


[testenv:sphinxext]
basepython=python2.5
deps=
    d2to1
    nose
    coverage
    simplejson
    Sphinx
commands=
    {envbindir}/coverage run {envbindir}/nosetests --with-xunit --xunit-file nosetests-{envname}.xml tests/test_sphinxext.py --verbose {posargs}
    {envbindir}/coverage xml -o coverage-{envname}.xml wsme/*.py wsme/rest/*.py wsmeext/*.py
    {envbindir}/coverage report --show-missing wsme/*.py wsme/rest/*.py wsmeext/*.py

[testenv:tg11]
basepython=python2.5
deps=
    d2to1
    nose
    webtest
    coverage
    simplejson
    suds
    lxml
commands=
    {envbindir}/easy_install -i http://www.turbogears.org/1.1/downloads/current/index/ 'TurboGears<1.1.99'
    {envbindir}/nosetests --with-xunit --xunit-file nosetests-{envname}.xml tests/test_tg1.py --verbose --with-coverage --cover-package wsme,wsmeext {posargs}
    {envbindir}/coverage xml -o coverage-{envname}.xml wsme/*.py wsme/rest/*.py wsmeext/*.py

[testenv:tg15]
basepython=python2.5
deps=
    d2to1
    nose
    webtest
    coverage
    simplejson
    suds
    lxml
commands=
    {envbindir}/easy_install -i http://www.turbogears.org/1.5/downloads/current/index/ 'TurboGears<1.5.99'
    {envbindir}/nosetests --with-xunit --xunit-file nosetests-{envname}.xml tests/test_tg15.py --verbose --with-coverage --cover-package wsme,wsmeext {posargs}
    {envbindir}/coverage xml -o coverage-{envname}.xml wsme/*.py wsme/rest/*.py wsmeext/*.py

[testenv:tg21]
basepython=python2.5
deps=
    d2to1
    nose
    coverage
    simplejson
commands=
    {envbindir}/easy_install -i http://www.turbogears.org/2.1/downloads/current/index/ 'TurboGears2<2.1.99' webtest
    {envbindir}/coverage run {envbindir}/nosetests --with-xunit --xunit-file nosetests-{envname}.xml tests/test_tg20.py --verbose {posargs}
    {envbindir}/coverage xml -o coverage-{envname}.xml wsme/*.py wsme/rest/*.py wsmeext/*.py
    {envbindir}/coverage report --show-missing wsme/*.py wsme/rest/*.py wsmeext/*.py

[testenv:pecan]
basepython=python2.7
deps=
    d2to1
    nose
    webtest
    coverage
    simplejson
    pecan
setenv=
    PYTHONPATH={toxinidir}
    COVERAGE_FILE=.coverage.{envname}

commands=
    {envbindir}/nosetests -w tests/pecantest test/tests/test_ws.py --with-xunit --xunit-file nosetests-{envname}.xml --verbose --with-coverage --cover-package wsme,wsmeext {posargs}
    {envbindir}/coverage xml -o coverage-{envname}.xml wsme/*.py wsme/rest/*.py wsmeext/*.py

[testenv:coverage]
basepython=python
deps=
    coverage
setenv=
    COVERAGE_FILE=.coverage
commands=
    {envbindir}/coverage erase
    {envbindir}/coverage combine
    {envbindir}/coverage xml wsme/*.py wsme/rest/*.py wsmeext/*.py
    {envbindir}/coverage report --show-missing wsme/*.py wsme/protocols/*.py wsmeext/*.py

[testenv:doc]
deps=
    Sphinx

changedir=
    doc

commands=
    {envbindir}/easy_install https://bitbucket.org/cdevienne/wsme-sqlalchemy/get/tip.zip
    {envbindir}/easy_install https://bitbucket.org/cdevienne/wsme-extdirect/get/tip.zip
    make clean ziphtml
